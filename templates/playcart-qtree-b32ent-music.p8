pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--bad apple, but it's 1.5 fps
--in 64x64 resolution

--[[data]]--

stage = peek(0x8004)
if stage == 0 then
	poke2(0x8002, 0x8010)
end
for i = 1, #datacarts do
	if stage == i-1 then
		poke(0x8004, i)
		load(datacarts[i], "back")
	end
end

v = peek(0x8000)
k = peek(0x8001)
p = peek2(0x8002)

for i = 1, #data do
	local c = ord(data[i])
	if 97<=c and c<=122 then
		c -= 97
	elseif 50<=c and c<=55 then
		c -= 24
	end
	v = (v << 5) | c
	k += 5
	if k >= 8 then
		k -= 8
		poke(p, (v&(0xff<<k))>>k)
		v = v & ~(0xff<<k)
		p += 1
	end
end

if outp > 0 then
	v = (v << outp) | outc
	k += outp
	if k >= 8 then
		k -= 8
		poke(p, (v&(0xff<<k))>>k)
		v = v & ~(0xff<<k)
		p += 1
	end
end

if k > 0 then
	v = v << (8 - k)
	poke(p, v)
	p += 1
end

printh(tostr(p, true))

n = p
p = 0x8010
k = 7

function next_bit()
	if p == n then
		return 0
	end
	local b = peek(p)
	b = (b & (1<<k)) >> k
	if k > 0 then
		k -= 1
	else
		k = 7; p += 1
	end
	return b
end

function draw_frame()
	local c = 7

	function rec(x0,y0,n,d)
		local l = false
		if d >= maxdepth then
			l = true
			c = next_bit()==0 and 0 or 7
		elseif next_bit() == 0 then
			l = true
		elseif next_bit() == 0 then
			l = true
			if c==7 then c=0 else c=7 end
		else
			l = false
		end

		if l then
			rectfill(x0,y0,x0+n-1,y0+n-1,c)
			if debug and n>=4 then
				rect(x0,y0,x0+n-1,y0+n-1,11)
			end
		else
			rec(x0,y0,n/2,d+1)
			rec(x0+n/2,y0,n/2,d+1)
			rec(x0,y0+n/2,n/2,d+1)
			rec(x0+n/2,y0+n/2,n/2,d+1)
		end
	end
	
	cls()
	rec(0,-16,128,0)
end
-->8
debug = false
notes = 0
inote = 0
beatstep = 4 / fpb

function _init()
	cls()
	music(0)
end

function _update()
	if not stat(57) then
		cls()
		return
	end
	if 0x5e00<=p and p<=0x7fff then
		return
	end
	if btnp(4) then
		printh(tostr(p, true))
	end
	if btnp(5) then
		debug = not debug
	end
	local cnote = stat(53)
	if cnote >= inote then
		notes += cnote - inote
	else
		notes += 32 - inote + cnote
	end
	inote = cnote
	while notes >= beatstep do
		notes -= beatstep
		draw_frame()
	end
end

__label__
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777700000007777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777700000000000777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777770000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777770000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777700000000000077777000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777700000000000000007700000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777000000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777770000000000000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777770000000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777777000000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777777000000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777777700000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777777700000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777777770000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777777770000000000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777000000000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777000000000000000000000000000000000007000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777700000000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777700000000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777770000000000000000000000000000000000077777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777000000000000000000000000000000000007777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777700000000000000000000000000000000000777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777700000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777700000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777700000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000000000000000000000000000000777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777000000000000000000000000000007777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000000000000000000000000007777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000000000000000000000000007777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000000000000000000000000007777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000007000000000000000000007777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000000000000000000000000077777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000000000000000000000000777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000000000000000000000000007777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777770000000000000000000000000000000777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777700000000000000000000000000000000077777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777700000000000000000000000000000000007777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777000000000000000000000000000000000000777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777770000000000000000000000000000000000000777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777700000000000000000000000000000000000000777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777700000000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777000000000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777000000000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777770000000000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777700000000000000000000000000000000000000000077777777777777777777777777777777777777777777
77777777777777777777777777777777777777777700000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777777000000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777777000000000000000000000000000000000000000000007777777777777777777777777777777777777777777
77777777777777777777777777777777777777770000000000000000000000000000000000000000000000000777777777777777777777777777777777777777
77777777777777777777777777777777777777770000000000000000000000000000000000000000000000000777777777777777777777777777777777777777
77777777777777777777777777777777777777700000000000000000000000000000000000000000000000000777777777777777777777777777777777777777
77777777777777777777777777777777777777700000000000000000000000000000000000000000000000007777777777777777777777777777777777777777
77777777777777777777777777777777777777700000000000000000000000000000000000000000000000007777777777777777777777777777777777777777
77777777777777777777777777777777777777000000700000000000000000000000000000000000000000007777777777777777777777777777777777777777
77777777777777777777777777777777777777000000770000000000000000000000000000000000000000000777777777777777777777777777777777777777
77777777777777777777777777777777777777000007770000000000000000000000000000000000000000000777777777777777777777777777777777777777
77777777777777777777777777777777777777000007770000000000000000000000000000000000000000000777777777777777777777777777777777777777
77777777777777777777777777777777777770000007700000000007000000000000000000000000000000000077777777777777777777777777777777777777
77777777777777777777777777777777777770000007700000000007000000000000000000000000000000000077777777777777777777777777777777777777
77777777777777777777777777777777777770000077700000000007700000000000000000000000000000000077777777777777777777777777777777777777
77777777777777777777777777777777777770000077700000000007700000000000000000000000000000000007777777777777777777777777777777777777
77777777777777777777777777777777777770000077700000000007700000000000000000000000000000000007777777777777777777777777777777777777
77777777777777777777777777777777777700000077700000000007700000000000000000000000000000000007777777777777777777777777777777777777
77777777777777777777777777777777777700000077000000000007700000000000000000000000000000000000777777777777777777777777777777777777
77777777777777777777777777777777777700000077000000000007700000000000000000000000000000000000777777777777777777777777777777777777
77777777777777777777777777777777777700000070000000000007700000000000000000000000000000000000077777777777777777777777777777777777
77777777777777777777777777777777777700000070000000000007700000000000000000000000000000000000077777777777777777777777777777777777
77777777777777777777777777777777777700000000000000000007700000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777700000000000000000007700000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777700000000000000000007700000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777700000000000000000007700000000000000000000000000000000000000777777777777777777777777777777777
77777777777777777777777777777777777700000000000000000007700000000000000000000000000000000000000777777777777777777777777777777777
77777777777777777777777777777777777700000000000000000007700000000000000000000000000000000000000077777777777777777777777777777777
77777777777777777777777777777777777700000000000000000077700000000000000000000000000000000000000077777777777777777777777777777777
77777777777777777777777777777777777700000000000000000077700000000000000000000000000000000000000007777777777777777777777777777777
77777777777777777777777777777777777700000000000000000077700000000000000000000000000000000000000007777777777777777777777777777777
77777777777777777777777777777777777700000000000000000077700000000000000000000000000000000000000000777777777777777777777777777777
77777777777777777777777777777777777700000000000000000077000000000000000000000000000000000000000000777777777777777777777777777777
77777777777777777777777777777777777700000000000000000077000000000000000000000000000000000000000000077777777777777777777777777777
77777777777777777777777777777777777700000000000000000077000000000000000000000000000000000000000000077777777777777777777777777777
77777777777777777777777777777777777700000000000000000770000000000000000000000000000000000000000000077777777777777777777777777777
77777777777777777777777777777777777770000000000000000770000000000000000000000000000000000000000000777777777777777777777777777777
77777777777777777777777777777777777777000000000000000770000000000000000000000000000000000000000000777777777777777777777777777777
77777777777777777777777777777777777770000000000000000700000000000000000000000000000000000000000000777777777777777777777777777777
77777777777777777777777777777777777770000000000000007700000000000000000000000000000000000000000000777777777777777777777777777777
77777777777777777777777777777777777770000000000000007700000000000000000000000000000000000000000000777777777777777777777777777777
77777777777777777777777777777777777770000000000000007700000000000000000000000000000000000000000007777777777777777777777777777777
77777777777777777777777777777777777770000000000000007000000000000000000000000000000000000000000007777777777777777777777777777777
77777777777777777777777777777777777770000000000000077000000000000000000000000000000000000000000007777777777777777777777777777777
77777777777777777777777777777777777770000000000000077000000000000000000000000000000000000000000007777777777777777777777777777777
77777777777777777777777777777777777770000000000000077000000000000000000000000000000000000000000007777777777777777777777777777777
77777777777777777777777777777777777777000000000000770000000000000000000000000000000000000000000007777777777777777777777777777777
77777777777777777777777777777777777777700000000000770000000000000000000000000000000000000000000007777777777777777777777777777777
77777777777777777777777777777777777777000000000007770000000000000000000000000000000000000000000077777777777777777777777777777777
77777777777777777777777777777777777777000000000007700000000000000000000000000000000000000000000777777777777777777777777777777777
77777777777777777777777777777777777777000000000077700000000000000000000000000000000000000000000777777777777777777777777777777777
77777777777777777777777777777777777777000000000077000000000000000000000000000000000000000000000777777777777777777777777777777777
77777777777777777777777777777777777770000000000777000000000000000000000000000000000000000000000777777777777777777777777777777777
77777777777777777777777777777777777770000000000770000000000000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777770000000007770000000000000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777770000000077700000000000000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777770000000077700000000000000000000000000000000000000000000077777777777777777777777777777777777
77777777777777777777777777777777777770000000777000000000000000000000000000000000000000000000077777777777777777777777777777777777
77777777777777777777777777777777777770000007777000000000000000000000000000000000000000000000077777777777777777777777777777777777
77777777777777777777777777777777777770000007770000000000000000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777770000077770000000000000000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777777000777700000000000000000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777777700777700000000000000000000000000000000000000000000000007777777777777777777777777777777777
77777777777777777777777777777777777777770777000000000000000000000000000000000000000000000000000777777777777777777777777777777777
77777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000000777777777777777777777777777777777
77777777777777777777777777777777777777777770000000000000000000000000000000000000000000000000000777777777777777777777777777777777
77777777777777777777777777777777777777777770000000000000000000000000000000000000000000000000000777777777777777777777777777777777

__sfx__
001020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010c20000f0530000000000000000f0530000000000000000f0530f0000f0000f0000f0530f0530f0530f0530f0530000000000000000f0530000000000000000f053000000f000000000f053000000f05300000
010c20000f0530000000000000000f0530000000000000000f0530f0000f0000f0000f0530f0530f0530f0530f0530000000000000000f0530000000000000000f053000000f0000000000000000000000000000
010c20000f0530000000000000000f0530000000000000000f0530f0000f0000f0000f0530f0030f0030f0030f0530000000000000000f0530000000000000000f053000000f000000000f053000000f05300000
011018000f05300000000000f05300000000000f05300000000000f05300000000000f05300000000000f05300000000000f0530f0530f0530f0530f0530f0530000000000000000000000000000000000000000
010c00000f0530000000000000000f0530000000000000000f0530f0000f0000f0000f0530f0030f0030f0030f0530000000000000000f0530000000000000000f053000000f053000000f053000000f00000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a10c20000345003450034550f4500f4550f4500d4500f4500345003450034550f4500f4550f4500d4500f4500345003450034550f4500f4550f4500d4500f4500345003455034500645008450084550645008450
a10c20000345003450034550f4500f4550f4500d4500f4500345003450034550f4500f4550f4500d4500f4500345003450034550f4500f4550f4500d4500f4500845008455064500845006450064550345006450
a10c20000345003450034550f4500f4550f4500d4500f4500345003450034550f4500f4550f4500d4500f4500345003450034550f4500f4550f4500d4500f4500845008450084500845006450064500645006450
a10c00000345003450034550b4500b4550b4500a4500b4500345003450034550b4500b4550b4500a4500b4500145001450014550d4500d4550d4500b4500d4500245002450024550e4500e4550e4500c4500e450
a10c00000345003450034550b4500b4550b4500a4500b4500345003450034550b4500b4550b4500a4500b4500145001450014550d4500d4550d4500b4500d4500145001450014550d4500d4550d4500b4500d450
a13008000b4500b4500b4500b45001450014500145001450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a13008000345003450034500345003450034500345003450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a13008000345003450034500345003453000000845006450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a10c00000345003450034550f4500f4550f4500d4500f4500345003450034550f4500f4550f4500d4500f4500345003450034550f4500f4550f4500d4500f450084500845008450084500b4500b4500b4500b450
013008000c4000c4000c4000c4000e4000e4000e4000e400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810001b1301d1301e130201302213022135271302513022130221351b1301b13522130201301e1301d13000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810001b1301d1301e130201302213022135201301e1301d1301b1301d1301e1301d1301b1301a1301d13000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810001b1301d1301e130201302213022135201301e1301d1301d1351e1301e1352013020135221302213500000000000000000000000000000000000000000000000000000000000000000000000000000000
551810002513027130221302013022130221352013022130251302713022130201302213022135201302213000000000000000000000000000000000000000000000000000000000000000000000000000000000
55181000201301e1301d130191301b1301b135191301b1301d1301e13020130221301b1301b135221302513000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810002513027130221302013022130221352013022130251302713022130201302213022135271302913000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810002a13029130271302513022130221352013022130201301e1301d130191301b1301b135221302513000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810002a13029130271302513022130221352013022130201301e1301d130191301b1301b135221002510000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810002a13029130271302513022130221352013022130201301e1301d130191301b1301b135171301a13000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a13008000c4500c4500c4500c4500e4500e4500e4500e450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a13008001045010450104501045010450104501045010450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a13008001045010450104501045010453104001040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810002613028130231302113023130231352113023130261302813023130211302313023135211302313000000000000000000000000000000000000000000000000000000000000000000000000000000000
55181000211301f1301e1301a1301c1301c1351a1301c1301e1301f13021130231301c1301c135231302613000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810002613028130231302113023130231352113023130261302813023130211302313023135281302a13000000000000000000000000000000000000000000000000000000000000000000000000000000000
551810002b1302a130281302613023130231352113023130211301f1301e1301a1301c1301c135000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 01424300
00 01424300
00 01424300
00 02424300
00 030a4300
00 030b4300
00 030a4300
00 040c4300
00 030a1400
00 050d1500
00 030a1400
00 040d1600
00 030a1400
00 050d1500
00 030a1400
00 040d1600
00 030e1700
00 050a1800
00 030e1700
00 040a1800
00 030e1700
00 050a1800
00 030e1900
00 040a1a00
00 410f1700
00 41101800
00 410f1700
00 41101800
00 410f1700
00 41101800
00 410f1900
00 41111b00
00 030a4300
00 030b4300
00 030a4300
00 040c4300
00 030a1400
00 050d1500
00 030a1400
00 040d1600
00 030a1400
00 050d1500
00 030a1400
00 040d1600
00 030e1700
00 050a1800
00 030e1700
00 040a1800
00 030e1700
00 050a1800
00 030e1900
00 04121a00
00 411e2800
00 411f2900
00 411e2800
00 411f2900
00 411e2800
00 411f2900
00 411e2a00
00 41202b00
00 41424300
00 41424300

